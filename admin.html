<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¹¸ç¦é£Ÿå ‚ - ç®¡ç†å¾Œå°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(180deg, #f5f5f5, #e0e0e0);
      font-family: "Noto Sans TC", sans-serif;
      padding: 20px;
    }
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    .header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 3px solid #ff9800;
    }
    .header h1 {
      color: #ff9800;
      font-weight: 900;
      margin-bottom: 10px;
    }
    .dish-card {
      background: #f9f9f9;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      border: 2px solid #e0e0e0;
    }
    .dish-card:hover {
      border-color: #ff9800;
      box-shadow: 0 5px 15px rgba(255, 152, 0, 0.2);
    }
    .preview-img {
      width: 100%;
      max-width: 300px;
      height: 300px;
      object-fit: cover;
      border-radius: 15px;
      margin-top: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .btn-upload {
      background: #ff9800;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    .btn-upload:hover {
      background: #f57c00;
      transform: translateY(-2px);
    }
    .btn-save {
      background: #4caf50;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1rem;
      transition: all 0.3s;
      margin-top: 20px;
    }
    .btn-save:hover {
      background: #45a049;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
    }
    .btn-preview {
      background: #2196f3;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1rem;
      transition: all 0.3s;
      margin-left: 10px;
    }
    .btn-preview:hover {
      background: #1976d2;
      transform: translateY(-2px);
    }
    .btn-reset {
      background: #f44336;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      margin-left: 10px;
    }
    .btn-reset:hover {
      background: #d32f2f;
    }
    input[type="text"], select {
      border-radius: 10px;
      border: 2px solid #e0e0e0;
      padding: 10px 15px;
      transition: border-color 0.3s;
    }
    input[type="text"]:focus, select:focus {
      border-color: #ff9800;
      outline: none;
    }
    .success-message {
      background: #4caf50;
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      display: none;
      text-align: center;
      font-weight: bold;
    }
    .dish-number {
      background: #ff9800;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2rem;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <div class="header">
      <h1>ğŸ± å¹¸ç¦é£Ÿå ‚ç®¡ç†å¾Œå°</h1>
      <p class="text-muted">ä¸Šå‚³èœè‰²åœ–ç‰‡ï¼Œç·¨è¼¯èœå–®è³‡è¨Š</p>
    </div>

    <div id="dishesContainer"></div>

    <!-- èƒŒæ™¯éŸ³æ¨‚è¨­å®š -->
    <div class="dish-card" style="border: 3px solid #ff9800; background: #fff9f0;">
      <div class="row align-items-center">
        <div class="col-12 mb-3">
          <span class="dish-number">ğŸµ</span>
          <strong style="font-size: 1.3rem;">èƒŒæ™¯éŸ³æ¨‚è¨­å®š</strong>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label"><strong>å•Ÿç”¨èƒŒæ™¯éŸ³æ¨‚</strong></label>
            <select class="form-select" id="musicEnabled">
              <option value="true">æ˜¯</option>
              <option value="false">å¦</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label"><strong>éŸ³é‡å¤§å° (0-100)</strong></label>
            <input type="range" class="form-range" id="musicVolume" min="0" max="100" value="50">
            <div class="text-center"><span id="volumeDisplay">50</span>%</div>
          </div>
          <div>
            <input type="file" id="musicFile" accept="audio/*" style="display: none;" onchange="handleMusicUpload()">
            <button class="btn-upload" onclick="document.getElementById('musicFile').click()">
              ğŸµ ä¸Šå‚³éŸ³æ¨‚æª”æ¡ˆ
            </button>
            <button class="btn-upload" onclick="removeMusicFile()" style="background: #f44336; margin-left: 10px;">
              ğŸ—‘ï¸ ç§»é™¤éŸ³æ¨‚
            </button>
          </div>
        </div>
        <div class="col-md-6 text-center">
          <div id="musicStatus" style="padding: 20px; background: #f5f5f5; border-radius: 15px; margin-top: 10px;">
            <p style="margin: 0; color: #666;">å°šæœªä¸Šå‚³éŸ³æ¨‚</p>
          </div>
          <audio id="musicPreview" controls style="width: 100%; margin-top: 15px; display: none;"></audio>
        </div>
      </div>
    </div>

    <div class="text-center">
      <button class="btn-save" onclick="saveAllDishes()">ğŸ’¾ å„²å­˜æ‰€æœ‰è®Šæ›´</button>
      <button class="btn-preview" onclick="previewMenu()">ğŸ‘ï¸ é è¦½èœå–®</button>
      <button class="btn-reset" onclick="resetToDefault()">ğŸ”„ æ¢å¾©é è¨­</button>
    </div>

    <div id="successMessage" class="success-message">
      âœ… å„²å­˜æˆåŠŸï¼è³‡æ–™å·²æ›´æ–°
    </div>
  </div>

  <script>
    // é è¨­èœå“è³‡æ–™
    const defaultDishes = [
      {
        name: 'æ—¥å¼é›æ’',
        tag: 'é»ƒé‡‘é…¥è„†',
        category: 'ä¸»èœ',
        image: 'https://images.unsplash.com/photo-1562967914-608f82629710?w=800&h=800&fit=crop',
        showYummy: true
      },
      {
        name: 'å’–å“©è‚‰æœ«',
        tag: 'å’–å“©æ§ç™½é£¯æ®ºæ‰‹',
        category: 'ä¸»èœ',
        image: 'https://images.unsplash.com/photo-1585937421612-70a008356fbe?w=800&h=800&fit=crop',
        showYummy: false
      },
      {
        name: 'èœœæ±åœ°ç“œ',
        tag: 'å¤©ç„¶ç”œé»',
        category: 'é…èœ',
        image: 'https://images.unsplash.com/photo-1568477988743-24e161afc111?w=800&h=800&fit=crop',
        showYummy: false
      },
      {
        name: 'ç‚’é’èŠ±èœ',
        tag: 'ä½å¡é«˜çº–',
        category: 'è”¬èœ',
        image: 'https://images.unsplash.com/photo-1628773822503-930a7eaecf80?w=800&h=800&fit=crop',
        showYummy: false
      },
      {
        name: 'æ¸…ç‚’é«˜éº—èœ',
        tag: 'æ¸…ç‚’ä½è² æ“”',
        category: 'è”¬èœ',
        image: 'https://images.unsplash.com/photo-1567338217310-275c2b79c90e?w=800&h=800&fit=crop',
        showYummy: false
      }
    ];

    // è¼‰å…¥æˆ–åˆå§‹åŒ–èœå“è³‡æ–™
    function loadDishes() {
      let dishes = localStorage.getItem('menuDishes');
      if (!dishes) {
        dishes = defaultDishes;
        localStorage.setItem('menuDishes', JSON.stringify(dishes));
      } else {
        dishes = JSON.parse(dishes);
      }
      return dishes;
    }

    // è¼‰å…¥éŸ³æ¨‚è¨­å®š
    function loadMusicSettings() {
      const musicEnabled = localStorage.getItem('musicEnabled') || 'false';
      const musicVolume = localStorage.getItem('musicVolume') || '50';
      const musicData = localStorage.getItem('musicData');
      const musicName = localStorage.getItem('musicName');

      document.getElementById('musicEnabled').value = musicEnabled;
      document.getElementById('musicVolume').value = musicVolume;
      document.getElementById('volumeDisplay').textContent = musicVolume;

      if (musicData && musicName) {
        document.getElementById('musicStatus').innerHTML = `
          <p style="margin: 0; color: #4caf50; font-weight: bold;">âœ… å·²ä¸Šå‚³éŸ³æ¨‚</p>
          <p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #666;">${musicName}</p>
        `;
        document.getElementById('musicPreview').src = musicData;
        document.getElementById('musicPreview').style.display = 'block';
      }
    }

    // è™•ç†éŸ³æ¨‚ä¸Šå‚³
    function handleMusicUpload() {
      const file = document.getElementById('musicFile').files[0];
      if (file) {
        // æª¢æŸ¥æª”æ¡ˆå¤§å° (é™åˆ¶ 10MB)
        if (file.size > 10 * 1024 * 1024) {
          alert('éŸ³æ¨‚æª”æ¡ˆå¤ªå¤§ï¼è«‹é¸æ“‡å°æ–¼ 10MB çš„æª”æ¡ˆã€‚');
          return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
          const musicData = e.target.result;
          localStorage.setItem('musicData', musicData);
          localStorage.setItem('musicName', file.name);
          
          document.getElementById('musicStatus').innerHTML = `
            <p style="margin: 0; color: #4caf50; font-weight: bold;">âœ… å·²ä¸Šå‚³éŸ³æ¨‚</p>
            <p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #666;">${file.name}</p>
          `;
          document.getElementById('musicPreview').src = musicData;
          document.getElementById('musicPreview').style.display = 'block';
          
          alert('éŸ³æ¨‚ä¸Šå‚³æˆåŠŸï¼åˆ¥å¿˜äº†é»æ“Šã€Œå„²å­˜æ‰€æœ‰è®Šæ›´ã€ã€‚');
        };
        reader.readAsDataURL(file);
      }
    }

    // ç§»é™¤éŸ³æ¨‚
    function removeMusicFile() {
      if (confirm('ç¢ºå®šè¦ç§»é™¤èƒŒæ™¯éŸ³æ¨‚å—ï¼Ÿ')) {
        localStorage.removeItem('musicData');
        localStorage.removeItem('musicName');
        document.getElementById('musicStatus').innerHTML = `
          <p style="margin: 0; color: #666;">å°šæœªä¸Šå‚³éŸ³æ¨‚</p>
        `;
        document.getElementById('musicPreview').style.display = 'none';
        document.getElementById('musicPreview').src = '';
        alert('éŸ³æ¨‚å·²ç§»é™¤ï¼');
      }
    }

    // éŸ³é‡æ»‘æ¡¿ç›£è½
    document.addEventListener('DOMContentLoaded', function() {
      const volumeSlider = document.getElementById('musicVolume');
      const volumeDisplay = document.getElementById('volumeDisplay');
      
      volumeSlider.addEventListener('input', function() {
        volumeDisplay.textContent = this.value;
      });
    });

    // æ¸²æŸ“æ‰€æœ‰èœå“å¡ç‰‡
    function renderDishes() {
      const dishes = loadDishes();
      const container = document.getElementById('dishesContainer');
      container.innerHTML = '';

      dishes.forEach((dish, index) => {
        const card = document.createElement('div');
        card.className = 'dish-card';
        card.innerHTML = `
          <div class="row align-items-center">
            <div class="col-12 mb-3">
              <span class="dish-number">${index + 1}</span>
              <strong style="font-size: 1.2rem;">èœå“ ${index + 1}</strong>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label"><strong>èœå</strong></label>
                <input type="text" class="form-control" id="name-${index}" value="${dish.name}">
              </div>
              <div class="mb-3">
                <label class="form-label"><strong>æ¨™ç±¤</strong></label>
                <input type="text" class="form-control" id="tag-${index}" value="${dish.tag}">
              </div>
              <div class="mb-3">
                <label class="form-label"><strong>åˆ†é¡</strong></label>
                <select class="form-select" id="category-${index}">
                  <option value="ä¸»èœ" ${dish.category === 'ä¸»èœ' ? 'selected' : ''}>ä¸»èœ</option>
                  <option value="é…èœ" ${dish.category === 'é…èœ' ? 'selected' : ''}>é…èœ</option>
                  <option value="è”¬èœ" ${dish.category === 'è”¬èœ' ? 'selected' : ''}>è”¬èœ</option>
                  <option value="æ¹¯å“" ${dish.category === 'æ¹¯å“' ? 'selected' : ''}>æ¹¯å“</option>
                  <option value="ç”œé»" ${dish.category === 'ç”œé»' ? 'selected' : ''}>ç”œé»</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label"><strong>é¡¯ç¤º "yummy yummy"</strong></label>
                <select class="form-select" id="yummy-${index}">
                  <option value="true" ${dish.showYummy ? 'selected' : ''}>æ˜¯</option>
                  <option value="false" ${!dish.showYummy ? 'selected' : ''}>å¦</option>
                </select>
              </div>
              <div>
                <input type="file" id="file-${index}" accept="image/*" style="display: none;" onchange="handleImageUpload(${index})">
                <button class="btn-upload" onclick="document.getElementById('file-${index}').click()">
                  ğŸ“· ä¸Šå‚³åœ–ç‰‡
                </button>
              </div>
            </div>
            <div class="col-md-6 text-center">
              <img id="preview-${index}" src="${dish.image}" alt="${dish.name}" class="preview-img">
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    // è™•ç†åœ–ç‰‡ä¸Šå‚³
    function handleImageUpload(index) {
      const file = document.getElementById(`file-${index}`).files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById(`preview-${index}`).src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    }

    // å„²å­˜æ‰€æœ‰èœå“
    function saveAllDishes() {
      const dishes = loadDishes();
      
      dishes.forEach((dish, index) => {
        dish.name = document.getElementById(`name-${index}`).value;
        dish.tag = document.getElementById(`tag-${index}`).value;
        dish.category = document.getElementById(`category-${index}`).value;
        dish.showYummy = document.getElementById(`yummy-${index}`).value === 'true';
        dish.image = document.getElementById(`preview-${index}`).src;
      });

      localStorage.setItem('menuDishes', JSON.stringify(dishes));
      
      // å„²å­˜éŸ³æ¨‚è¨­å®š
      localStorage.setItem('musicEnabled', document.getElementById('musicEnabled').value);
      localStorage.setItem('musicVolume', document.getElementById('musicVolume').value);
      
      // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
      const message = document.getElementById('successMessage');
      message.style.display = 'block';
      setTimeout(() => {
        message.style.display = 'none';
      }, 3000);
    }

    // é è¦½èœå–®
    function previewMenu() {
      window.open('menu.html', '_blank');
    }

    // æ¢å¾©é è¨­
    function resetToDefault() {
      if (confirm('ç¢ºå®šè¦æ¢å¾©é è¨­è¨­å®šå—ï¼Ÿé€™å°‡æ¸…é™¤æ‰€æœ‰è‡ªè¨‚å…§å®¹ã€‚')) {
        localStorage.setItem('menuDishes', JSON.stringify(defaultDishes));
        renderDishes();
        alert('å·²æ¢å¾©é è¨­è¨­å®šï¼');
      }
    }

    // é é¢è¼‰å…¥æ™‚æ¸²æŸ“
    renderDishes();
    loadMusicSettings();
  </script>
</body>
</html>